# Security, Monitoring, and Quality Tooling Guide

This document lists the security, monitoring, and quality tools currently configured in this repository, how to initialize them, and how to use them in development and CI.

## Tooling Inventory
- Sentry (error monitoring)
- PostHog (analytics and feature flags)
- Security headers + CSP (Next.js headers)
- ESLint (linting)
- Vitest (unit tests)
- Playwright (E2E and visual tests)
- Lighthouse CI (performance audits)
- Codecov (coverage reporting)
- Sentry Spotlight (local dev error monitoring)

## 1. Sentry (Error Monitoring)
**Where it’s configured**
- `sentry.client.config.ts`
- `sentry.server.config.ts`
- `next.config.ts` (Sentry webpack plugin)
- `src/app/global-error.tsx` (client error capture)

**Environment variables**
- `NEXT_PUBLIC_SENTRY_DSN`
- `NEXT_PUBLIC_SENTRY_DISABLED`

**Initialization**
1. Create a Sentry project for Next.js.
2. Set `NEXT_PUBLIC_SENTRY_DSN` in `.env` or `.env.production`.
3. Optional: Set `NEXT_PUBLIC_SENTRY_DISABLED=true` to disable.

**Usage**
- Test in dev by triggering a client error or using the test snippet in docs.
- Build will upload source maps automatically if Sentry is enabled.

**Commands**
```bash
npm run dev
npm run build
npm run start
```

## 2. PostHog (Analytics + Feature Flags)
**Where it’s configured**
- `src/modules/common/components/PostHogProvider.tsx`
- `src/modules/common/components/PostHogPageView.tsx`
- `src/libs/feature-flags.ts`

**Environment variables**
- `NEXT_PUBLIC_POSTHOG_KEY`
- `NEXT_PUBLIC_POSTHOG_HOST`

**Initialization**
1. Create a PostHog project.
2. Set `NEXT_PUBLIC_POSTHOG_KEY` and `NEXT_PUBLIC_POSTHOG_HOST` in `.env`.

**Usage**
- Page views are tracked automatically via `PostHogPageView`.
- Feature flags are available via `featureFlags` utilities.

**Commands**
```bash
npm run dev
```

## 3. Security Headers + CSP
**Where it’s configured**
- `next.config.ts` (headers + CSP)

**Usage**
- Headers are applied to all routes at build/runtime.
- CSP settings should be validated in production.

**Commands**
```bash
curl -I https://yourdomain.com | grep -i "x-frame-options\|strict-transport\|content-security"
```

## 4. ESLint (Linting)
**Where it’s configured**
- `eslint.config.mjs`

**Usage**
```bash
npm run lint
npm run lint:fix
```

## 5. Vitest (Unit Tests)
**Where it’s configured**
- `vitest.config.mts`

**Usage**
```bash
npm run test
```

## 6. Playwright (E2E + Visual Tests)
**Where it’s configured**
- `playwright.config.ts`
- `tests/e2e/*.e2e.ts`

**Usage**
```bash
npm run test:e2e
```

## 7. Lighthouse CI (Performance Audits)
**Where it’s configured**
- `lighthouserc.js`

**Usage**
```bash
npm run lighthouse
```

## 8. Codecov (Coverage Reporting)
**Where it’s configured**
- `codecov.yml`

**Initialization**
1. Create a Codecov project and get a token.
2. Set `CODECOV_TOKEN` in CI environment variables.

**Usage**
- Coverage reports are generated by Vitest and uploaded in CI.

## 9. Sentry Spotlight (Local Dev Monitoring)
**Where it’s configured**
- `dev:spotlight` script in `package.json`

**Usage**
```bash
npm run dev:spotlight
```

## Common Workflow Commands
```bash
npm install
npm run dev
npm run build
npm run start
```

## Environment Setup Checklist
- `NEXT_PUBLIC_POSTHOG_KEY`
- `NEXT_PUBLIC_POSTHOG_HOST`
- `NEXT_PUBLIC_SENTRY_DSN`
- `NEXT_PUBLIC_SENTRY_DISABLED`
- `NEXT_PUBLIC_LOGGING_LEVEL`
- `NEXT_PUBLIC_API_BASE_URL`

## Notes
- All environment access must go through `Env`.
- Do not call `process.env` in application code.
